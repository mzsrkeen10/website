---
title: "AOJ 0284 Happy End Problem"
slug: "aoj0284"
date: 2019-03-31T19:38:59+09:00
draft: false
categories: ["競プロ"]
tags: ["AOJ", "PCK","計算幾何"]
---

[NCAstarさんの記事](http://d.hatena.ne.jp/tei3344/20150124/1422068763)を読んで解法を理解したので，お気持ちのメモ．  

<!--more-->

[問題](https://onlinejudge.u-aizu.ac.jp/challenges/sources/PCK/Prelim/0284?year=2013)

### 問題概要

xy平面上の\\(N\\)点が与えられる．\\(i\\)番目の点の座標は\\( (x_i , y_i) \\)である．
質問がQ個与えられる．それぞれの質問では整数\\(k\\)が与えられるので，
それに対し，\\(N\\)個の点の中から\\(k\\)個の点を選んで出来る凸多角形の中で最小のものを答えよ．

#### 制約

- \\( 3 \le N \le 40 \\)
- \\( -10000 \leq x_i , y_i \leq 10000 \\)
- \\( 1 \le Q \le N \\)
- \\( 3 \le k_i \le N \\)
- 入力される点の座標は全て異なる
- どの3点も同一直線上にない
- 各質問に対して面積最小の凸多角形は1つ，2番めとの面積の差は0.0001以上

#### 出力

質問ごとに凸多角形の頂点を最も左下にある頂点から反時計回りに出力する．  
凸多角形が作れない場合は`NA`と出力する．

### 方針

全探索が間に合わないので，もう少し良い方法を考えたいです．  
とりあえず，凹多角形は考えたくないので，凸多角形だけを考える方法を探してみます．

まず，三角形は凸です．

|![](/images/post/2019-03-31-aoj0284/triangle.png)|
|:--:|
|三角形（凸）|

この三角形に1点追加して，凸な四角形を作る方法を考えます．  
これは，点の進行方向が反時計回りになるように点を追加することで出来ます．

|![](/images/post/2019-03-31-aoj0284/ccw.png)|![](/images/post/2019-03-31-aoj0284/cw.png)|
|:--:|:--:|
|反時計回り（凸）|時計回り（凹）|

また，この時の凸四角形の面積は，元々の三角形の面積（緑）と，
頂点を追加したことで増えた新しい三角形の面積（水色）を足せば求まります．

|![](/images/post/2019-03-31-aoj0284/quadrangle.png)|
|:--:|
|四角形（凸）|

一般の場合についても同様に，凸なn角形とその面積が求まっていれば，
凸なn+1角形を作ることが出来，その面積も求まります．

|![](/images/post/2019-03-31-aoj0284/polygon.png)|
|:--:|
|五角形の場合|

ここで，n+1角形の面積は，

- 最後に追加した三角形
- n角形

の2つから求まるので，n角形の面積の最小値が分かっていれば，
追加する三角形を上手く選ぶことで，n+1角形の面積も最小にすることが出来そうです．

ここから，n角形の面積の最小値を持つDPを考えます．
n+1角形の面積を求めるには，最後に追加した三角形とn角形の情報が必要なので，
DPの状態としては以下が必要になります（多分）．

1. 頂点の数（n）
1. n角形の始点
1. n-1番目に追加した頂点
1. n番目に追加した頂点

3,4は追加する頂点を選ぶために必要です．
また，2,4は追加した頂点と組み合わせて三角形の面積を求めるのに必要です．

DPの形で書いておくと，
```
DP[i][j][k][l] := 「頂点がi個，始点がj，i-1番目に追加した頂点がk，i番目に追加した頂点がlの時のi角形の面積の最小値」
```
となります．

遷移は，追加する頂点mを探索して，
```
DP[i+1][j][l][m] = min(DP[i+1][j][l][m], DP[i][j][k][l] + 三角形jlmの面積)
```
となります．DP全体ではi,j,k,lも全て調べるので，5重ループになります．  
時間計算量は\\(O(N^5)\\)で，\\( N \\)は高々40なので制限時間に間に合います．

DPの初期化は三角形の面積を全て求めておけば良いです．

なお，DPをする前に，頂点を座標でソートしたり偏角でソートしたりする下準備が必要で，
また出力が面積ではなく多角形そのものなので，復元も必要になります．
凸多角形が存在しなかったときの処理も忘れずに．
